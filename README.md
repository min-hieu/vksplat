# SplatStream

[![Build Status](https://github.com/jaesung-cs/splatstream/workflows/Build%20Python%20Package/badge.svg)](https://github.com/jaesung-cs/splatstream/actions/workflows/build.yml)
[![Release Status](https://github.com/jaesung-cs/splatstream/workflows/Release%20Python%20Package/badge.svg)](https://github.com/jaesung-cs/splatstream/actions/workflows/release.yml)
[![Python Versions](https://img.shields.io/badge/python-3.10%20%7C%203.11%20%7C%203.12%20%7C%203.13%20%7C%203.14-blue.svg)](https://www.python.org/downloads/)
[![Platforms](https://img.shields.io/badge/platform-linux%20%7C%20windows%20%7C%20macos-lightgrey.svg)](https://github.com/jaesung-cs/splatstream/actions)

Python bindings for streamlined 3dgs rendering.
- This is a more modularized and organized code of my previous c++ project [vkgs](https://github.com/jaesung-cs/vkgs).
- This code is being actively developed, so expect some bugs until the codes are stabilized.
- Current version is ~30% faster than [gsplat](https://github.com/nerfstudio-project/gsplat) in basic benchmarks; still trying to improve performance.

## Feature Highlights
- Fast speed: rasterization using Graphics capability.
- Memory-efficiency: reuse resources by double buffering.
- Pure Vulkan with a minimal set of dependencies. No CUDA required.
- Renderable pre-trained models from the [original Gaussian Splatting](https://github.com/graphdeco-inria/gaussian-splatting) project.

## Limitations
- No gradient computation; this code is for rendering, not training.
- Perfect pinhole camera only.
- Rendering image slightly differs from `gsplat` (suspectedly due to splat culling logic, i.e. frustum test, near plane of the camera)
- No `pytorch` integration.

## Requirements (End Users)
- A GPU
  - The GPU indexed first in your system will be automatically selected.
  - Device selection is TODO.
- Up-to-date graphic drivers
  - Check [this (link to gpuinfo)](https://vulkan.gpuinfo.org/listdevices.php) out and confirm if your GPU supports API version >=1.4. Most of GPUs may have >=1.4.
  - Vulkan 1.4 was released on December 3, 2024. You must have updated your graphic driver since then.
  - Download the latest graphic driver from your GPU vendor's website for splatstream to use the latest feature in Vulkan.
- Windows: x64
- Ubuntu: x64
- MacOS: arm64
- `python>=3.10`

## Installation
- Install from pip
  ```bash
  $ pip install splatstream
  ```
- Install from source
  ```bash
  $ pip install ./binding
  ```

## Usage
```python
import splatstream as ss

# Splats from .ply file
splats = ss.load_from_ply("my_splats.ply")
# Splats from numpy array
splats = ss.gaussian_splats(
  means,      # np.ndarray, (N, 3)
  quats,      # np.ndarray, (N, 4), wxyz convention.
  scales,     # np.ndarray, (N, 3)
  opacities,  # np.ndarray, (N)
  colors,     # np.ndarray, (N, K, 3), where K is one of [1, 4, 9, 16]
)

# Draw
images = ss.draw(
  splats,
  viewmats,          # np.ndarray, (..., 4, 4)
  Ks,                # np.ndarray, (..., 3, 3)
  width,             # int
  height,            # int
  near=0.1, far=1e3  # Do not use too low near nor too high far, otherwise z-fighting
).numpy()            # np.ndarray, (..., H, W, 4), np.uint8, RGBA.

from PIL import Image
for i in range(len(images)):
  Image.fromarray(images[i, :, :, :3]).save(f"color_{i}.png")
  Image.fromarray(images[i, :, :, 3]).save(f"alpha_{i}.png")
```

### macOS: double-click `.ply` files

Register a lightweight app wrapper that launches `inspector` when `.ply` files are opened from Finder:

```bash
./tools/install_mac_viewer_app.sh
```

This creates `~/Applications/SplatStreamViewer.app`. Set it as the default once: Finder → right-click a `.ply` → **Get Info** → **Open With** → **SplatStream Viewer** → **Change All…**.

## Samples

![train](/media/train.gif) ![random](/media/random.gif)

Animation generated by `splatstream`.
- Left: train
- Right: result of `test/test_random.py`. Color and alpha images for randomly generated splats with repeating background.

## Requirements (Dev)
- `VulkanSDK>=1.4.328.1`
  - `VK_KHR_push_descriptor` has been promoted to 1.4 and is supported by `MoltenVK` in `MacOS` since the bug was fixed in `1.4.328.1`.
  - Environment variables set up according to OS.
    - Windows: use installer.
    - Linux/MacOS: run setup_env.sh.
- `cmake>=3.15`
  - Either system-installed, or via pip or conda.
    ```bash
    $ pip install cmake
    or
    $ conda install conda-forge::cmake
    ```
- `python>=3.10`

## Build c++
```bash
$ cmake . -B build
$ cmake --build build --config Release -j
```

## Benchmark
- Tested on my PC: NVIDIA GeForce RTX 5080, Windows.

|    | Dataset | scale | #imgs | chunk size | PSNR | FPS |
|:--:|:-------:|:-----:|:-----:|:----------:|:----:|:---:|
|   gsplat        | truck | 0.5 | 251 |  10 | 20.59 ± 1.66 |   330.61   |
| **splatstream** | truck | 0.5 | 251 | N/A | 20.67 ± 1.58 | **436.64** |
|   gsplat        | train | 0.5 | 301 |  10 | 22.29 ± 2.41 |   339.76   |
| **splatstream** | train | 0.5 | 301 | N/A | 22.11 ± 2.29 | **494.96** |

See [bench](/bench/README.md) for more details.

## Technical Details

See [here](/DETAILS.md).

## TODO
- [x] Support SH degree
- [x] Support background color
- [ ] Device selection
- [ ] c++ viewer
- [x] Build wheels and publish
- [ ] Find reasons for pixel value difference with `gsplat`
- [x] Benchmark
  - [ ] Benchmark more datasets

## Contribution

- Feedback, feature request, issue report, or PRs are welcome!
- c++ must be formatted with `clang-format` with rules defined in `.clang-format`.
- python shall be formatted, but no specific formatter yet.
